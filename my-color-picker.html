<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="height=device-height, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>颜色选择器</title>
  <style media="screen">
    * {
      padding: 0;
      margin: 0;
    }
    .colors {
      margin-left: 10px;
    }
  .alpha {
    margin-top: 10px;
  }
  .preview {
    float: left;
    margin-left: 10px;
    margin-top: 10px;
  }
  </style>
</head>

<body>
  <div class="">
    <div class="">
      <canvas class="panel" id="color_picker_panel"></canvas>

      <canvas class="colors" id="color_picker_colors"></canvas>


    </div>
    <canvas class="alpha" id="color_picker_alpha"></canvas>

    <div id="preview" class="preview"></div>

  </div>
  <script type="text/javascript">
    (function() {

      var cur_r
      var cur_g
      var cur_b
      var cur_alpha

      var curColor = 'rgba(255,0,0,1)';

      const size = {
        small: {
          colors: {
            width: 12,
            height: 120
          },
          panel: {
            width: 120,
            height: 120,
          },
          alpha: {
            width: 120,
            height: 12,
          },
          preview: {
            width: 12,
            height: 12,
          }
        },
        middle: {
          colors: {
            width: 16,
            height: 160
          },
          panel: {
            width: 160,
            height: 160,
          },
          alpha: {
            width: 160,
            height: 16,
          },
          preview: {
            width: 16,
            height: 16,
          }
        },
        large: {
          colors: {
            width: 20,
            height: 200
          },
          panel: {
            width: 200,
            height: 200,
          },
          alpha: {
            width: 200,
            height: 20,
          },
          preview: {
            width: 20,
            height: 20,
          }
        }
      }

      let color_picker_size = 'small'; // small, middle, or large
      const color_picker_colors = document.getElementById("color_picker_colors")
      const color_picker_panel = document.getElementById("color_picker_panel")
      const color_picker_alpha = document.getElementById("color_picker_alpha")
      const preview = document.getElementById("preview")

      const color_picker_colors_ctx = color_picker_colors.getContext('2d')
      const color_picker_panel_ctx = color_picker_panel.getContext('2d')
      const color_picker_alpha_ctx = color_picker_alpha.getContext('2d')

      init()

      function initCanvasSize(sizeType) {
        color_picker_colors.width = size[sizeType].colors.width
        color_picker_colors.height = size[sizeType].colors.height

        color_picker_panel.width = size[sizeType].panel.width
        color_picker_panel.height = size[sizeType].panel.height

        color_picker_alpha.width = size[sizeType].alpha.width
        color_picker_alpha.height = size[sizeType].alpha.height

        preview.style.width = size[sizeType].preview.width
        preview.style.height = size[sizeType].preview.height
      }

      function updatePreview() {

      }


      function init() {
        initCanvasSize(color_picker_size)
        colorpanel()
        colorBox(curColor)
        colorAlpha()
      }

      function colorpanel() {
        var width = color_picker_colors.offsetWidth
        var height = color_picker_colors.offsetHeight
        var gradientBar = color_picker_colors_ctx.createLinearGradient(0, 0, 0, height);
        gradientBar.addColorStop(0, '#f00');
        gradientBar.addColorStop(1 / 6, '#f0f');
        gradientBar.addColorStop(2 / 6, '#00f');
        gradientBar.addColorStop(3 / 6, '#0ff');
        gradientBar.addColorStop(4 / 6, '#0f0');
        gradientBar.addColorStop(5 / 6, '#ff0');
        gradientBar.addColorStop(1, '#f00');

        color_picker_colors_ctx.fillStyle = gradientBar;
        color_picker_colors_ctx.fillRect(0, 0, width, height);

        color_picker_colors.addEventListener('mousedown', function(ev) {
          const ePos = {
            x: ev.offsetX || ev.layerX,
            y: ev.offsetY || ev.layerY
          }
          console.log(ePos)
        })
      }

      function colorBox(color) {
        const width = color_picker_panel.offsetWidth
        const height = color_picker_panel.offsetHeight
        // 底色填充，也就是（举例红色）到白色
        var gradientBase = color_picker_panel_ctx.createLinearGradient(0, 0, width, 0);
        gradientBase.addColorStop(1, color); // 选定颜色
        gradientBase.addColorStop(0, 'rgba(255,255,255,1)'); // 白色
        color_picker_panel_ctx.fillStyle = gradientBase;
        color_picker_panel_ctx.fillRect(0, 0, width, height);
        // 第二次填充，黑色到透明
        var my_gradient1 = color_picker_panel_ctx.createLinearGradient(0, 0, 0, height);
        my_gradient1.addColorStop(0, 'rgba(0,0,0,0)'); // 透明
        my_gradient1.addColorStop(1, 'rgba(0,0,0,1)'); // 黑色
        color_picker_panel_ctx.fillStyle = my_gradient1;
        color_picker_panel_ctx.fillRect(0, 0, width, height);
      }

      function colorAlpha(color) {
        const width = color_picker_alpha.offsetWidth
        const height = color_picker_alpha.offsetHeight
        var gradientBase = color_picker_alpha_ctx.createLinearGradient(0, 0, width, 0)
        gradientBase.addColorStop(0, 'rgba(0, 0, 0 ,0)')
        gradientBase.addColorStop(1, 'rgba(0, 0, 0, 1)')
        color_picker_alpha_ctx.fillStyle = gradientBase
        color_picker_alpha_ctx.fillRect(0, 0, width, height);
      }
    })()
  </script>
</body>

</html>
